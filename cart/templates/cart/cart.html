{% extends "base.html" %}
{% load static %}
{% load cart_tools %}

{% block page_header %}
    <div>
        <h1>PAGE HEADER</h1>
    </div>
{% endblock %}

{% block content %}

    <div class="uppercase text-xl mt-6 mb-4 text-center">
        Your Shopping Cart:
    </div>
    <div>
        <div>
            <div >
                {% if cart_items %}

                <div class="flex justify-center">
                <div class="flex w-full md:max-w-6xl justify-center border-4 border-slate-900 rounded-lg">
                    <table class="w-full text-left text-gray-500 rounded shadow-md">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50 ">
                            <tr>
                                <th scope="col" class="py-3 px-6">
                                    Product
                                </th>
                                <th scope="col" class="py-3 px-6">
                                    Price
                                </th>
                                <th scope="col" class="py-3 px-6">
                                    Quantity
                                </th>
                                <th scope="col" class="py-3 px-6">
                                    Remove Item
                                </th>
                                <th scope="col" class="py-3 px-6">
                                    Subtotal
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in cart_items %}
                            <tr class="bg-white border-b ">
                                <th scope="row" class="py-4 px-6 font-medium text-gray-900 whitespace-nowrap ">
                                    {{ item.product.name }}
                                </th>
                                <td class="py-4 px-6">
                                    ${{ item.product.price }}
                                </td>
                                <td class="py-4 px-6">
                                    <form >
                                        {% csrf_token %}
                                        <div >
                                            <div >
                                                <div >
                                                    <button  
                                                        data-item_id="{{ item.item_id }}" id="decrement-qty_{{ item.item_id }}">
                                                        <span>
                                                            <i ></i>
                                                        </span>
                                                    </button>
                                                </div>
                                                <!-- Value below refers to the quantity currently in the shopping cart-->
                                                <input 
                                                    name="quantity" value="{{ item.quantity }}" min="1" max="99"
                                                    data-item_id="{{ item.item_id }}"
                                                    id="id_qty_{{ item.item_id }}">
                                                <div >
                                                    <button 
                                                        data-item_id="{{ item.item_id }}" id="increment-qty_{{ item.item_id }}">
                                                        <span>
                                                            <i ></i>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                    <a><small>Update</small></a>
                                    <a><small>Remove</small></a>
                                </td>
                                <td
                                

                                <a class="remove-item" id="remove_{{ item.item_id }}">
                                    <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full">
                                        Remove Item
                                      </button>
                                    </a>

                                </td>


                                <td class="py-4 px-6">
                                    <p >${{ item.product.price | calc_subtotal:item.quantity }}</p>
                                </td>
                            </tr>
                            {% endfor %}
                        <tr class="bg-white border-b font-bold">

                            <td class="">
                                <p ></p>
                            </td>
                            <td class="">
                                <p ></p>
                            </td>
                            <td class="">
                                <p ></p>
                            </td>
                            <td class="">
                                <p ></p>
                            </td>
                            <td class="py-4 px-6">
                                <p >Cart Total: ${{ total|floatformat:2 }}</p>
                            </td>
                        </tr>

                        <tr class="bg-white border-b font-bold">
                            <td class="">
                                <p ></p>
                            </td>
                            <td class="">
                                <p ></p>
                            </td>
                            <td class="">
                                <p ></p>
                            </td>
                            <td class="">
                                <p ></p>
                            </td>
                            <td class="py-4 px-6">
                                <p >Delivery: ${{ total|floatformat:2 }}</p>
                            </td>
                        </tr>

                        <tr class="bg-white border-b font-bold">
                            <td class="">
                                <p ></p>
                            </td>
                            <td class="">
                                <p ></p>
                            </td>
                            <td class="">
                                <p ></p>
                            </td>
                            <td class="">
                                <p ></p>
                            </td>
                            <td class="py-4 px-6">
                                <p >Grand Total: ${{ grand_total|floatformat:2 }}</p>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>




            </div>

            <div class="flex flex-row justify-center mb-4 mt-4 space-x-4">
            <a href="{% url 'store' %}">
                <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full">
                    Keep Shopping
                  </button>
                </a>

                <a href="{% url 'store' %}">
                  <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full">
                    Secure Checkout
                  </button>

                </a>
            </div>
                    


        {% else %}
            <!--    Start: Condition on where bag is empty -->
            <div class="flex justify-center my-4">
            <div class="md:max-w-6xl w-full bg-white border-4 border-slate-900 rounded-lg">
                <div class="text-center text-4xl my-4">
            Your cart is empty !
        </div>
        <div class="flex justify-center mb-4">
            <a href="{% url 'store' %}">
                <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full">
                  Return to Store
                </button>
                </a>
            </div>
            </div>
        </div>
            <!--    End: Condition on where bag is empty -->
        {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block postloadjs %}
{{ block.super }}


<script type="text/javascript">
    // Remove item and reload on click
    $('.remove-item').click(function(e) {
        var csrfToken = "{{ csrf_token }}";
        var itemId = $(this).attr('id').split('remove_')[1];
        var url = `/cart/remove/${itemId}/`;
        var data = {'csrfmiddlewaretoken': csrfToken};

        $.post(url, data)
         .done(function() {
             location.reload();
         });
    })
</script>

{% endblock  %} 